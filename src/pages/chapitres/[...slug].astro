---
import { getCollection } from 'astro:content';
import ChapterLayout from '../../layouts/ChapterLayout.astro';

export async function getStaticPaths() {
  const chapters = await getCollection('chapters');
  const sortedChapters = chapters.sort((a, b) => a.data.chapterNumber - b.data.chapterNumber);

  return sortedChapters.map((chapter, index) => ({
    params: { slug: chapter.slug },
    props: {
      chapter,
      prevChapter: index > 0 ? sortedChapters[index - 1] : null,
      nextChapter: index < sortedChapters.length - 1 ? sortedChapters[index + 1] : null,
    },
  }));
}

const { chapter, prevChapter, nextChapter } = Astro.props;
const { Content } = await chapter.render();
---

<ChapterLayout chapter={chapter} prevChapter={prevChapter} nextChapter={nextChapter}>
  <Content />
</ChapterLayout>
