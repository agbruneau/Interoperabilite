---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import ChapterCard from '../components/ChapterCard.astro';
import { getCollection } from 'astro:content';

const chapters = await getCollection('chapters');
const sortedChapters = chapters.sort((a, b) => a.data.chapterNumber - b.data.chapterNumber);

const baseUrl = import.meta.env.BASE_URL;

// Domain feature cards data
const domains = [
  {
    title: 'Le Verbe',
    subtitle: 'Intégration des Applications',
    description: 'Orchestration des processus et interactions synchrones. API Gateway, BFF, Strangler Fig.',
    color: 'accent-verb',
    bgColor: 'bg-accent-verb/10',
    borderColor: 'border-accent-verb/30',
    chapter: 'III',
    href: `${baseUrl}chapitres/03-applications`,
  },
  {
    title: 'Le Nom',
    subtitle: 'Intégration des Données',
    description: 'Cohérence de l\'état et accessibilité. CDC, CQRS, Data Mesh, Schema Registry.',
    color: 'accent-noun',
    bgColor: 'bg-accent-noun/10',
    borderColor: 'border-accent-noun/30',
    chapter: 'IV',
    href: `${baseUrl}chapitres/04-donnees`,
  },
  {
    title: 'Le Signal',
    subtitle: 'Intégration des Événements',
    description: 'Réactivité et découplage maximal. Pub/Sub, Event Sourcing, Saga Pattern.',
    color: 'accent-signal',
    bgColor: 'bg-accent-signal/10',
    borderColor: 'border-accent-signal/30',
    chapter: 'V',
    href: `${baseUrl}chapitres/05-evenements`,
  },
];
---

<BaseLayout title="Accueil">
  <Header />

  <main class="flex-1">
    <!-- Hero Section -->
    <section class="relative overflow-hidden">
      <!-- Background gradient -->
      <div class="absolute inset-0 bg-gradient-to-br from-accent-verb/5 via-transparent to-accent-signal/5"></div>

      <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-24 md:py-32">
        <div class="text-center max-w-4xl mx-auto">
          <h1 class="text-4xl md:text-5xl lg:text-6xl font-sans font-bold text-white mb-6 leading-tight">
            Interopérabilité en Écosystème d'Entreprise
          </h1>
          <p class="text-xl md:text-2xl text-text-secondary mb-4 font-serif">
            Convergence des Architectures d'Intégration
          </p>
          <p class="text-lg text-text-tertiary mb-10 max-w-2xl mx-auto">
            Du couplage fort au découplage maximal : une exploration du continuum
            <span class="block text-center mt-2">
              <span class="text-accent-verb">Applications</span> →
              <span class="text-accent-noun">Données</span> →
              <span class="text-accent-signal">Événements</span>
            </span>
          </p>
          <div class="flex flex-col sm:flex-row gap-4 justify-center">
            <a href={`${baseUrl}chapitres/01-introduction`} class="btn-primary">
              Commencer la lecture
            </a>
            <a href="#chapitres" class="btn-secondary">
              Explorer les chapitres
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- Three Domains Section -->
    <section class="py-20 bg-bg-secondary/50">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
          <h2 class="text-2xl md:text-3xl font-sans font-semibold text-white mb-4">
            Les Trois Domaines d'Intégration
          </h2>
          <p class="text-text-secondary max-w-2xl mx-auto">
            Une stratégie hybride qui orchestre trois approches complémentaires selon les besoins métier.
          </p>
        </div>

        <div class="grid md:grid-cols-3 gap-6">
          {domains.map((domain) => (
            <a
              href={domain.href}
              class:list={[
                'group block p-8 rounded-2xl border transition-all duration-300',
                'hover:scale-[1.02] hover:no-underline',
                domain.bgColor,
                domain.borderColor,
                `hover:border-${domain.color}`
              ]}
            >
              <div class="flex items-center gap-3 mb-4">
                <span class:list={['text-3xl font-sans font-bold', `text-${domain.color}`]}>
                  {domain.title}
                </span>
                <span class="text-text-tertiary text-sm font-sans">Ch. {domain.chapter}</span>
              </div>
              <h3 class="text-white font-sans font-medium mb-3">
                {domain.subtitle}
              </h3>
              <p class="text-text-secondary text-sm">
                {domain.description}
              </p>
            </a>
          ))}
        </div>
      </div>
    </section>

    <!-- Presentation Section -->
    <section class="py-20 bg-bg-secondary/50">
      <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-8">
          <a
            href={`${baseUrl}Presentation.pdf`}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-3 text-xl md:text-2xl font-sans font-semibold text-accent-link hover:text-white transition-colors"
          >
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            Ouvrir la présentation PDF
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
            </svg>
          </a>
        </div>
        <div class="rounded-2xl overflow-hidden border border-border-subtle shadow-2xl">
          <img
            src={`${baseUrl}Poster.png`}
            alt="Poster - Interopérabilité en Écosystème d'Entreprise"
            class="w-full h-auto"
          />
        </div>
      </div>
    </section>

    <!-- Chapters Grid Section -->
    <section id="chapitres" class="py-20">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
          <h2 class="text-2xl md:text-3xl font-sans font-semibold text-white mb-4">
            Table des Chapitres
          </h2>
          <p class="text-text-secondary max-w-2xl mx-auto">
            11 chapitres et annexes pour une exploration complète de l'interopérabilité d'entreprise.
          </p>
        </div>

        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
          {sortedChapters.map((chapter) => (
            <ChapterCard
              href={`${baseUrl}chapitres/${chapter.slug}`}
              romanNumeral={chapter.data.romanNumeral}
              title={chapter.data.title}
              description={chapter.data.description}
              domain={chapter.data.domainColor}
            />
          ))}
        </div>
      </div>
    </section>

    <!-- Thesis Section -->
    <section class="py-20 bg-bg-secondary/50">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <blockquote class="border-l-0 border-none pl-0 italic">
          <p class="text-xl md:text-2xl text-text-primary mb-6 leading-relaxed">
            « L'interopérabilité n'est pas un état binaire qu'on atteint ou qu'on manque,
            mais un <strong class="text-white not-italic">continuum</strong> qui s'étend
            du couplage fort au découplage maximal. »
          </p>
          <footer class="text-text-secondary text-sm">
            — Thèse centrale de l'essai
          </footer>
        </blockquote>
      </div>
    </section>
  </main>

  <Footer />
</BaseLayout>
