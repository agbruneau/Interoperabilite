---
import { getCollection } from 'astro:content';

interface Props {
  currentSlug: string;
}

const { currentSlug } = Astro.props;
const baseUrl = import.meta.env.BASE_URL;

const chapters = await getCollection('chapters');
const sortedChapters = chapters.sort((a, b) => a.data.chapterNumber - b.data.chapterNumber);

const domainColors = {
  verb: 'text-accent-verb',
  noun: 'text-accent-noun',
  signal: 'text-accent-signal',
  neutral: 'text-text-tertiary',
};
---

<nav class="space-y-1">
  <h3 class="text-text-tertiary text-xs font-sans font-semibold uppercase tracking-wider mb-4">
    Chapitres
  </h3>

  {sortedChapters.map((chapter) => {
    const isActive = chapter.slug === currentSlug;
    const domainColor = domainColors[chapter.data.domainColor || 'neutral'];

    return (
      <a
        href={`${baseUrl}chapitres/${chapter.slug}`}
        class:list={[
          'block px-3 py-2 rounded-lg text-sm transition-colors hover:no-underline',
          isActive
            ? 'bg-bg-tertiary text-white'
            : 'text-text-secondary hover:text-white hover:bg-bg-hover'
        ]}
      >
        <div class="flex items-center gap-2">
          <span class:list={['font-sans font-medium shrink-0', isActive ? 'text-white' : domainColor]}>
            {chapter.data.romanNumeral}
          </span>
          <span class="truncate">
            {chapter.data.title}
          </span>
        </div>
      </a>
    );
  })}
</nav>
